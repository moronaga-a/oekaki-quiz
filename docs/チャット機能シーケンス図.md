# ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³

Stimulusã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½¿ã£ãŸãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã¨æ­£èª¤åˆ¤å®šã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‹•ä½œãƒ•ãƒ­ãƒ¼

---

## 1. é€šå¸¸ãƒãƒ£ãƒƒãƒˆé€ä¿¡ï¼ˆåŸºæœ¬ãƒ•ãƒ­ãƒ¼ï¼‰

```mermaid
sequenceDiagram
    participant User as ğŸ‘¤ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼<br/>(A)
    participant Chat as ğŸ’¬ Chat Controller
    participant Server as ğŸ–¥ï¸ GameChannel
    participant Others as ğŸ‘¥ ä»–ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼

    User->>Chat: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›ã€Œãƒãƒ­ãƒ¼ï¼ã€
    User->>Chat: Sendãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯

    Chat->>Server: perform('send_message', {<br/>  message: 'ãƒãƒ­ãƒ¼ï¼',<br/>  is_answer: false<br/>})

    Note over Server: é€šå¸¸ãƒãƒ£ãƒƒãƒˆ<br/>(æ­£èª¤åˆ¤å®šãªã—)

    Server->>Chat: broadcast('chat_message')
    Server->>Others: broadcast('chat_message')

    Chat->>Chat: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 

    Others->>Others: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 
```

---

## 2. å›ç­”é€ä¿¡ã¨æ­£èª¤åˆ¤å®š

```mermaid
sequenceDiagram
    participant User as ğŸ‘¤ å›ç­”è€…<br/>(B)
    participant Chat as ğŸ’¬ Chat Controller
    participant Server as ğŸ–¥ï¸ GameChannel
    participant TopicService as ğŸ“ TopicService
    participant All as ğŸ‘¥ å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼

    User->>Chat: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›ã€Œã‚Šã‚“ã”ï¼ã€
    User->>Chat: Answerãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯

    Chat->>Server: perform('send_message', {<br/>  message: 'ã‚Šã‚“ã”ï¼',<br/>  is_answer: true<br/>})

    Note over Server: æ­£èª¤åˆ¤å®šå®Ÿè¡Œ

    Server->>TopicService: check_answer?('ã‚Šã‚“ã”', 'ã‚Šã‚“ã”ï¼')
    TopicService->>TopicService: æ­£è¦åŒ–å‡¦ç†<br/>(ã‚«ã‚¿ã‚«ãƒŠâ†’ã²ã‚‰ãŒãª)
    TopicService->>Server: true (æ­£è§£)

    Server->>All: broadcast('correct_answer', {<br/>  player_name: 'B',<br/>  answer: 'ã‚Šã‚“ã”ï¼'<br/>})

    All->>All: æ­£è§£ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
    Note over All: ğŸ‰ Bã•ã‚“ã®å›ç­”<br/>ã€Œã‚Šã‚“ã”ï¼ã€ã‚ãŸã‚Š
```

---

## 3. ä¸æ­£è§£ã®å ´åˆ

```mermaid
sequenceDiagram
    participant User as ğŸ‘¤ å›ç­”è€…<br/>(C)
    participant Chat as ğŸ’¬ Chat Controller
    participant Server as ğŸ–¥ï¸ GameChannel
    participant TopicService as ğŸ“ TopicService
    participant All as ğŸ‘¥ å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼

    User->>Chat: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›ã€ŒãƒãƒŠãƒŠã€
    User->>Chat: Answerãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯

    Chat->>Server: perform('send_message', {<br/>  message: 'ãƒãƒŠãƒŠ',<br/>  is_answer: true<br/>})

    Server->>TopicService: check_answer?('ã‚Šã‚“ã”', 'ãƒãƒŠãƒŠ')
    TopicService->>Server: false (ä¸æ­£è§£)

    Server->>All: broadcast('incorrect_answer', {<br/>  player_name: 'C',<br/>  answer: 'ãƒãƒŠãƒŠ'<br/>})

    All->>All: èµ¤è‰²ã®ä¸æ­£è§£ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
    Note over All: ğŸ˜‡ Cã•ã‚“ã®å›ç­”<br/>ã€ŒãƒãƒŠãƒŠã€æ®‹å¿µ
```

## ã¾ã¨ã‚

### åŸºæœ¬ãƒ•ãƒ­ãƒ¼
```
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›
    â†“
Send / Answer ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    â†“
WebSocketé€ä¿¡ (is_answer ãƒ•ãƒ©ã‚°ã§åˆ†å²)
    â†“
ã‚µãƒ¼ãƒãƒ¼å´ã§å‡¦ç†
    â”œâ”€ é€šå¸¸ãƒãƒ£ãƒƒãƒˆ â†’ ãã®ã¾ã¾ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ
    â””â”€ å›ç­” â†’ æ­£èª¤åˆ¤å®š â†’ çµæœã‚’ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ
    â†“
å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
```
